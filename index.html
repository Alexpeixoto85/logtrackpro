
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogiTrack Pro - Sistema Completo de Gestão Logística</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --info: #4895ef;
            --warning: #f72585;
            --danger: #e63946;
            --dark: #1d3557;
            --light: #f1faee;
            --gray: #adb5bd;
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 80px;
            --header-height: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--dark) 0%, #14213d 100%);
            color: white;
            transition: all 0.3s ease;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }
        
        .sidebar-header {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: var(--header-height);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            font-size: 24px;
            color: var(--success);
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
            transition: opacity 0.3s;
        }
        
        .sidebar.collapsed .logo-text {
            opacity: 0;
            width: 0;
        }
        
        .toggle-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .sidebar.collapsed .toggle-sidebar {
            transform: rotate(180deg);
        }
        
        .sidebar-menu {
            padding: 20px 0;
            list-style: none;
        }
        
        .sidebar-menu li {
            position: relative;
        }
        
        .sidebar-menu a {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--success);
            padding-left: 30px;
        }
        
        .sidebar-menu i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
            font-size: 18px;
        }
        
        .sidebar.collapsed .menu-text {
            opacity: 0;
            width: 0;
        }
        
        .menu-text {
            transition: opacity 0.3s;
        }
        
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: all 0.3s ease;
            padding: 20px;
        }
        
        .sidebar.collapsed ~ .main-content {
            margin-left: var(--sidebar-collapsed-width);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 28px;
            color: var(--dark);
            font-weight: 700;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid var(--primary);
        }
        
        .notification-bell {
            position: relative;
            font-size: 20px;
            color: var(--dark);
            cursor: pointer;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--warning);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.3s ease;
            border-left: 5px solid var(--primary);
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--success));
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 16px;
            color: var(--gray);
            font-weight: 600;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card-icon.primary {
            background: linear-gradient(135deg, var(--primary), var(--info));
        }
        
        .card-icon.success {
            background: linear-gradient(135deg, var(--success), #4cc9f0);
        }
        
        .card-icon.warning {
            background: linear-gradient(135deg, var(--warning), #f72585);
        }
        
        .card-icon.danger {
            background: linear-gradient(135deg, var(--danger), #e63946);
        }
        
        .card-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        .card-footer {
            font-size: 14px;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .card-footer.positive {
            color: var(--success);
        }
        
        .card-footer.negative {
            color: var(--danger);
        }
        
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 35px;
            overflow-x: auto;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .table-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        
        .status.pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status.delivered {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status.cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status.active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status.inactive {
            background-color: #e2e3e5;
            color: #383d41;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--info));
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #4cc9f0);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #e63946);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #f72585);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--gray), #6c757d);
            color: white;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .required::after {
            content: " *";
            color: var(--danger);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            outline: none;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 25px;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .modal-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: var(--danger);
        }
        
        .scanner-container {
            text-align: center;
            padding: 30px;
            border: 2px dashed #ddd;
            border-radius: 12px;
            margin-bottom: 25px;
            background-color: #f9f9f9;
        }
        
        .scanner-placeholder {
            font-size: 60px;
            color: var(--gray);
            margin-bottom: 15px;
        }
        
        #scanner-preview {
            width: 100%;
            max-width: 500px;
            height: 300px;
            background-color: #000;
            margin: 0 auto 20px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #eaeaea;
            margin-bottom: 25px;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .subtab-content {
            display: none;
        }
        
        .subtab-content.active {
            display: block;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 35px;
            height: 350px;
        }
        
        #inactivityModal .modal-content {
            max-width: 450px;
            text-align: center;
        }
        
        .inactivity-icon {
            font-size: 60px;
            color: var(--warning);
            margin-bottom: 20px;
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: var(--sidebar-collapsed-width);
            }
            
            .sidebar .menu-text {
                display: none;
            }
            
            .main-content {
                margin-left: var(--sidebar-collapsed-width);
            }
            
            .sidebar-header h2 {
                display: none;
            }
            
            .sidebar-menu a {
                text-align: center;
                padding: 15px 10px;
            }
            
            .sidebar-menu i {
                margin-right: 0;
                font-size: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .cards {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .user-info {
                align-self: flex-end;
            }
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .setting-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: all 0.3s;
        }
        
        .setting-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
        }
        
        .setting-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .setting-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
        }
        
        .setting-icon.backup {
            background: linear-gradient(135deg, var(--primary), var(--info));
        }
        
        .setting-icon.security {
            background: linear-gradient(135deg, var(--success), #4cc9f0);
        }
        
        .setting-icon.notifications {
            background: linear-gradient(135deg, var(--warning), #f72585);
        }
        
        .setting-icon.clean {
            background: linear-gradient(135deg, var(--danger), #e63946);
        }
        
        .setting-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .backup-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
        }
        
        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
            transform: translateX(400px);
            transition: transform 0.3s;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }
        
        .toast.success .toast-icon {
            background-color: var(--success);
        }
        
        .toast.error .toast-icon {
            background-color: var(--danger);
        }
        
        .toast.warning .toast-icon {
            background-color: var(--warning);
        }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .toast-message {
            font-size: 14px;
            color: var(--gray);
        }
        
        .close-toast {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 16px;
        }
        
        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        
        .filter-select {
            min-width: 200px;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--gray);
        }
        
        .text-danger {
            color: var(--danger);
        }
        
        .recibo-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 35px;
        }
        
        .recibo-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 20px;
        }
        
        .recibo-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .recibo-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .recibo-section {
            margin-bottom: 25px;
        }
        
        .recibo-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
            padding-bottom: 8px;
        }
        
        .recibo-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px dashed #eaeaea;
        }
        
        .recibo-total {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: 700;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid var(--dark);
        }
        
        .recibo-footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
            color: var(--gray);
        }
        
        .qr-code {
            width: 120px;
            height: 120px;
            margin: 20px auto;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
        }
        
        .qr-code i {
            font-size: 40px;
            color: var(--gray);
        }
        
        .ranking-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .ranking-badge.gold {
            background-color: #FFD700;
            color: #333;
        }
        
        .ranking-badge.silver {
            background-color: #C0C0C0;
            color: #333;
        }
        
        .ranking-badge.bronze {
            background-color: #CD7F32;
            color: white;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-label:hover {
            background: var(--secondary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-shipping-fast logo-icon"></i>
                    <span class="logo-text">LogiTrack Pro</span>
                </div>
                <button class="toggle-sidebar">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-home"></i> <span class="menu-text">Dashboard</span></a></li>
                <li><a href="#" data-tab="empresas"><i class="fas fa-building"></i> <span class="menu-text">Empresas</span></a></li>
                <li><a href="#" data-tab="entregadores"><i class="fas fa-users"></i> <span class="menu-text">Entregadores</span></a></li>
                <li><a href="#" data-tab="mercadorias"><i class="fas fa-box"></i> <span class="menu-text">Mercadorias</span></a></li>
                <li><a href="#" data-tab="entregas"><i class="fas fa-shipping-fast"></i> <span class="menu-text">Entregas</span></a></li>
                <li><a href="#" data-tab="financeiro"><i class="fas fa-chart-line"></i> <span class="menu-text">Financeiro</span></a></li>
                <li><a href="#" data-tab="relatorios"><i class="fas fa-chart-bar"></i> <span class="menu-text">Relatórios</span></a></li>
                <li><a href="#" data-tab="configuracoes"><i class="fas fa-cog"></i> <span class="menu-text">Configurações</span></a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>Dashboard</h1>
                <div class="user-info">
                    <div class="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <img src="https://ui-avatars.com/api/?name=Admin+User&background=4361ee&color=fff&size=128" alt="Usuário">
                    <span>Administrador</span>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="tab-content active">
                <div class="cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Entregas Hoje</div>
                            <div class="card-icon primary">
                                <i class="fas fa-shipping-fast"></i>
                            </div>
                        </div>
                        <div class="card-value" id="entregasHoje">0</div>
                        <div class="card-footer positive">
                            <i class="fas fa-arrow-up"></i> <span id="variacaoEntregas">0%</span> em relação a ontem
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Recebimentos Pendentes</div>
                            <div class="card-icon success">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="card-value" id="valorReceber">R$ 0,00</div>
                        <div class="card-footer">A receber das empresas</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Pagamentos Pendentes</div>
                            <div class="card-icon danger">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                        <div class="card-value" id="valorPagar">R$ 0,00</div>
                        <div class="card-footer">A pagar aos entregadores</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Lucro Estimado</div>
                            <div class="card-icon warning">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="valorLucro">R$ 0,00</div>
                        <div class="card-footer positive">
                            <i class="fas fa-arrow-up"></i> <span id="variacaoLucro">0%</span> este mês
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Entregas Recentes</h2>
                        <button class="btn btn-primary" id="btnNovaEntrega">
                            <i class="fas fa-plus"></i> Nova Entrega
                        </button>
                    </div>
                    <table id="entregasTable">
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Empresa</th>
                                <th>Entregador</th>
                                <th>Data</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- As entregas serão carregadas aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="chart-container">
                    <canvas id="entregasChart"></canvas>
                </div>
            </div>

            <!-- Empresas -->
            <div id="empresas" class="tab-content">
                <div class="header">
                    <h1>Empresas de Logística</h1>
                    <button class="btn btn-primary" id="btnNovaEmpresa">
                        <i class="fas fa-plus"></i> Nova Empresa
                    </button>
                </div>

                <div class="search-filter">
                    <div class="search-box">
                        <input type="text" id="searchEmpresas" placeholder="Buscar empresas...">
                    </div>
                    <div class="filter-select">
                        <select id="filterEmpresas">
                            <option value="">Todas as empresas</option>
                            <option value="15">Pagamento em 15 dias</option>
                            <option value="30">Pagamento em 30 dias</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table id="empresasTable">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CNPJ</th>
                                <th>Contato</th>
                                <th>Telefone</th>
                                <th>Pagamento</th>
                                <th>Valor/Entrega</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- As empresas serão carregadas aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Entregadores -->
            <div id="entregadores" class="tab-content">
                <div class="header">
                    <h1>Entregadores</h1>
                    <button class="btn btn-primary" id="btnNovoEntregador">
                        <i class="fas fa-plus"></i> Novo Entregador
                    </button>
                </div>

                <div class="search-filter">
                    <div class="search-box">
                        <input type="text" id="searchEntregadores" placeholder="Buscar entregadores...">
                    </div>
                    <div class="filter-select">
                        <select id="filterEntregadores">
                            <option value="">Todos os status</option>
                            <option value="ativo">Ativos</option>
                            <option value="inativo">Inativos</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table id="entregadoresTable">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF</th>
                                <th>Telefone</th>
                                <th>Veículo</th>
                                <th>Comissão</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Os entregadores serão carregados aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Mercadorias -->
            <div id="mercadorias" class="tab-content">
                <div class="header">
                    <h1>Mercadorias</h1>
                    <div>
                        <button class="btn btn-warning" id="btnScanner">
                            <i class="fas fa-camera"></i> Scanner
                        </button>
                        <button class="btn btn-primary" id="btnNovaMercadoria">
                            <i class="fas fa-plus"></i> Nova Mercadoria
                        </button>
                    </div>
                </div>

                <div class="scanner-container" id="scannerContainer" style="display: none;">
                    <div id="scanner-preview"></div>
                    <p>Posicione o código de barras ou QR Code na frente da câmera</p>
                    <div class="backup-options">
                        <button class="btn btn-secondary" id="btnIniciarScanner">Iniciar Scanner</button>
                        <button class="btn btn-danger" id="btnPararScanner">Parar Scanner</button>
                    </div>
                    <div id="scanner-result" style="margin-top: 15px;"></div>
                </div>

                <div class="search-filter">
                    <div class="search-box">
                        <input type="text" id="searchMercadorias" placeholder="Buscar mercadorias...">
                    </div>
                    <div class="filter-select">
                        <select id="filterMercadorias">
                            <option value="">Todos os status</option>
                            <option value="pendente">Pendentes</option>
                            <option value="entregue">Entregues</option>
                            <option value="cancelado">Cancelados</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table id="mercadoriasTable">
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Descricao</th>
                                <th>Empresa</th>
                                <th>Destinatário</th>
                                <th>Data Recebimento</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- As mercadorias serão carregadas aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Entregas -->
            <div id="entregas" class="tab-content">
                <div class="header">
                    <h1>Controle de Entregas</h1>
                    <button class="btn btn-primary" id="btnNovaEntrega2">
                        <i class="fas fa-plus"></i> Nova Entrega
                    </button>
                </div>

                <div class="tabs">
                    <div class="tab active" data-subtab="pendentes">Pendentes</div>
                    <div class="tab" data-subtab="em-andamento">Em Andamento</div>
                    <div class="tab" data-subtab="entregues">Entregues</div>
                    <div class="tab" data-subtab="canceladas">Canceladas</div>
                </div>

                <div id="pendentes" class="subtab-content active">
                    <div class="table-container">
                        <table id="entregasPendentesTable">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Empresa</th>
                                    <th>Entregador</th>
                                    <th>Data</th>
                                    <th>Rota</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- As entregas pendentes serão carregadas aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="em-andamento" class="subtab-content">
                    <div class="table-container">
                        <table id="entregasAndamentoTable">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Empresa</th>
                                    <th>Entregador</th>
                                    <th>Data Saída</th>
                                    <th>Rota</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- As entregas em andamento serão carregadas aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="entregues" class="subtab-content">
                    <div class="table-container">
                        <table id="entregasEntreguesTable">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Empresa</th>
                                    <th>Entregador</th>
                                    <th>Data Entrega</th>
                                    <th>Rota</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- As entregas entregues serão carregadas aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="canceladas" class="subtab-content">
                    <div class="table-container">
                        <table id="entregasCanceladasTable">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Empresa</th>
                                    <th>Entregador</th>
                                    <th>Data</th>
                                    <th>Motivo</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- As entregas canceladas serão carregadas aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Financeiro -->
            <div id="financeiro" class="tab-content">
                <div class="header">
                    <h1>Financeiro</h1>
                    <div>
                        <button class="btn btn-warning" id="btnGerarRecibo">
                            <i class="fas fa-receipt"></i> Gerar Recibo
                        </button>
                        <button class="btn btn-primary" id="btnNovoLancamento">
                            <i class="fas fa-plus"></i> Novo Lançamento
                        </button>
                    </div>
                </div>

                <div class="cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">A Receber</div>
                            <div class="card-icon success">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="card-value" id="valorReceberFinanceiro">R$ 0,00</div>
                        <div class="card-footer">Das empresas de logística</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">A Pagar</div>
                            <div class="card-icon danger">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                        <div class="card-value" id="valorPagarFinanceiro">R$ 0,00</div>
                        <div class="card-footer">Aos entregadores</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Lucro Líquido</div>
                            <div class="card-icon warning">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="valorLucroFinanceiro">R$ 0,00</div>
                        <div class="card-footer">Este mês</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="financeiroChart"></canvas>
                </div>

                <div class="table-container">
                    <h2 class="table-title">Fluxo de Caixa</h2>
                    <table id="fluxoCaixaTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Descrição</th>
                                <th>Categoria</th>
                                <th>Valor</th>
                                <th>Tipo</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- O fluxo de caixa será carregado aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Relatórios -->
            <div id="relatorios" class="tab-content">
                <div class="header">
                    <h1>Relatórios</h1>
                    <div>
                        <button class="btn btn-warning" id="btnImprimirRelatorio">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                        <button class="btn btn-primary" id="btnGerarRelatorio">
                            <i class="fas fa-download"></i> Gerar PDF
                        </button>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" data-subtab="empresa">Por Empresa</div>
                    <div class="tab" data-subtab="entregador">Por Entregador</div>
                    <div class="tab" data-subtab="ranking">Ranking</div>
                </div>

                <!-- Relatório por Empresa -->
                <div id="empresa" class="subtab-content active">
                    <div class="cards">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Total de Empresas</div>
                                <div class="card-icon primary">
                                    <i class="fas fa-building"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalEmpresas">0 empresas</div>
                            <div class="card-footer">Relatório detalhado</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Entregas Realizadas</div>
                                <div class="card-icon success">
                                    <i class="fas fa-shipping-fast"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalEntregasEmpresas">0 entregas</div>
                            <div class="card-footer">Métricas de performance</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Receita Total</div>
                                <div class="card-icon warning">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                            <div class="card-value" id="receitaTotalEmpresas">R$ 0,00</div>
                            <div class="card-footer">Receitas e despesas</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h2 class="table-title">Relatório por Empresa - <span id="mesAtualRelatorio">Junho 2023</span></h2>
                        <table id="relatorioEmpresasTable">
                            <thead>
                                <tr>
                                    <th>Empresa</th>
                                    <th>Entregas Realizadas</th>
                                    <th>Valor Recebido</th>
                                    <th>Comissão Paga</th>
                                    <th>Lucro</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- O relatório será carregado aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Relatório por Entregador -->
                <div id="entregador" class="subtab-content">
                    <div class="cards">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Total de Entregadores</div>
                                <div class="card-icon primary">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalEntregadores">0 entregadores</div>
                            <div class="card-footer">Relatório detalhado</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Entregas Realizadas</div>
                                <div class="card-icon success">
                                    <i class="fas fa-shipping-fast"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalEntregasEntregadores">0 entregas</div>
                            <div class="card-footer">Métricas de performance</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Comissão Total</div>
                                <div class="card-icon warning">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                            <div class="card-value" id="comissaoTotalEntregadores">R$ 0,00</div>
                            <div class="card-footer">Receitas e despesas</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h2 class="table-title">Relatório por Entregador - <span id="mesAtualRelatorioEntregador">Junho 2023</span></h2>
                        <table id="relatorioEntregadoresTable">
                            <thead>
                                <tr>
                                    <th>Entregador</th>
                                    <th>Entregas Realizadas</th>
                                    <th>Comissão Total</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- O relatório será carregado aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Ranking de Entregadores -->
                <div id="ranking" class="subtab-content">
                    <div class="cards">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Top Entregador</div>
                                <div class="card-icon primary">
                                    <i class="fas fa-trophy"></i>
                                </div>
                            </div>
                            <div class="card-value" id="topEntregador">-</div>
                            <div class="card-footer">Maior número de entregas</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Média de Entregas</div>
                                <div class="card-icon success">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                            </div>
                            <div class="card-value" id="mediaEntregas">0</div>
                            <div class="card-footer">Por entregador</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Entregadores Ativos</div>
                                <div class="card-icon warning">
                                    <i class="fas fa-user-check"></i>
                                </div>
                            </div>
                            <div class="card-value" id="entregadoresAtivos">0</div>
                            <div class="card-footer">Com entregas realizadas</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h2 class="table-title">Ranking de Entregadores</h2>
                        <table id="rankingEntregadoresTable">
                            <thead>
                                <tr>
                                    <th>Posição</th>
                                    <th>Entregador</th>
                                    <th>Entregas Realizadas</th>
                                    <th>Comissão Total</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- O ranking será carregado aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Configurações -->
            <div id="configuracoes" class="tab-content">
                <div class="header">
                    <h1>Configurações do Sistema</h1>
                </div>

                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon backup">
                                <i class="fas fa-database"></i>
                            </div>
                            <div>
                                <h3 class="setting-title">Backup de Dados</h3>
                                <p>Faça backup dos dados do sistema</p>
                            </div>
                        </div>
                        <p>Último backup: <span id="ultimoBackup">Nunca</span></p>
                        <div class="backup-options">
                            <button class="btn btn-primary" id="btnBackupNow">
                                <i class="fas fa-download"></i> Fazer Backup
                            </button>
                            <button class="btn btn-success" id="btnRestoreBackup">
                                <i class="fas fa-upload"></i> Restaurar
                            </button>
                            <input type="file" id="backupFileInput" class="file-input" accept=".json">
                            <label for="backupFileInput" class="file-label">
                                <i class="fas fa-file-import"></i> Importar Backup
                            </label>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon security">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div>
                                <h3 class="setting-title">Segurança</h3>
                                <p>Configurações de segurança do sistema</p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inactivityTimeout">Tempo de Inatividade (minutos)</label>
                            <input type="number" id="inactivityTimeout" value="1" min="1" max="60">
                        </div>
                        <div class="form-group">
                            <label for="autoBackup">Backup Automático</label>
                            <select id="autoBackup">
                                <option value="enabled">Habilitado</option>
                                <option value="disabled">Desabilitado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="autoLogout">Logout Automático</label>
                            <select id="autoLogout">
                                <option value="enabled">Habilitado</option>
                                <option value="disabled">Desabilitado</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon notifications">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div>
                                <h3 class="setting-title">Notificações</h3>
                                <p>Configurar notificações do sistema</p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="notifEntregas" checked> Notificações de Entrega
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="notifFinanceiro" checked> Notificações Financeiras
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="notifSistema"> Notificações de Sistema
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="notifEmail"> Notificações por Email
                            </label>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon clean">
                                <i class="fas fa-broom"></i>
                            </div>
                            <div>
                                <h3 class="setting-title">Limpeza do Sistema</h3>
                                <p>Limpar dados e redefinir o sistema</p>
                            </div>
                        </div>
                        <p class="text-danger"><i class="fas fa-exclamation-triangle"></i> Atenção: Esta ação não pode ser desfeita</p>
                        <div class="backup-options">
                            <button class="btn btn-danger" id="btnLimparDados">
                                <i class="fas fa-trash"></i> Limpar Todos os Dados
                            </button>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="manterConfig">Manter configurações ao limpar</label>
                            <input type="checkbox" id="manterConfig" checked>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <h2 class="table-title">Logs do Sistema</h2>
                    <div class="table-header">
                        <div></div>
                        <button class="btn btn-sm btn-warning" id="btnLimparLogs">
                            <i class="fas fa-trash"></i> Limpar Logs
                        </button>
                    </div>
                    <table id="logsTable">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Usuário</th>
                                <th>Ação</th>
                                <th>Detalhes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Os logs serão carregados aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Inatividade -->
    <div class="modal" id="inactivityModal">
        <div class="modal-content">
            <div class="inactivity-icon">
                <i class="fas fa-clock"></i>
            </div>
            <h2 class="modal-title">Você ainda está aí?</h2>
            <p>Sua sessão ficou inativa por algum tempo. O que você gostaria de fazer?</p>
            <div style="display: flex; gap: 15px; margin-top: 25px; justify-content: center;">
                <button class="btn btn-success" id="btnStayActive">
                    <i class="fas fa-check"></i> Sim, Continuar
                </button>
                <button class="btn btn-danger" id="btnLogout">
                    <i class="fas fa-sign-out-alt"></i> Não, Sair
                </button>
            </div>
            <p style="margin-top: 20px; font-size: 14px; color: var(--gray);">
                <i class="fas fa-info-circle"></i> Ao sair, um backup automático será realizado.
            </p>
        </div>
    </div>

    <!-- Modal Nova Empresa -->
    <div class="modal" id="modalEmpresa">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Empresa</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="formEmpresa">
                <div class="form-row">
                    <div class="form-group">
                        <label for="empresaNome" class="required">Nome da Empresa</label>
                        <input type="text" id="empresaNome" required>
                    </div>
                    <div class="form-group">
                        <label for="empresaTelefone" class="required">Telefone</label>
                        <input type="text" id="empresaTelefone" placeholder="(00) 00000-0000" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="empresaCnpj">CNPJ</label>
                        <input type="text" id="empresaCnpj" placeholder="00.000.000/0000-00">
                    </div>
                    <div class="form-group">
                        <label for="empresaEmail">E-mail</label>
                        <input type="email" id="empresaEmail">
                    </div>
                </div>
                <div class="form-group">
                    <label for="empresaEndereco">Endereço</label>
                    <input type="text" id="empresaEndereco">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="empresaPagamento">Período de Pagamento</label>
                        <select id="empresaPagamento">
                            <option value="15">15 dias</option>
                            <option value="30">30 dias</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="empresaValor">Valor por Entrega (R$)</label>
                        <input type="number" id="empresaValor" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Empresa
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Novo Entregador -->
    <div class="modal" id="modalEntregador">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Entregador</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="formEntregador">
                <div class="form-row">
                    <div class="form-group">
                        <label for="entregadorNome" class="required">Nome Completo</label>
                        <input type="text" id="entregadorNome" required>
                    </div>
                    <div class="form-group">
                        <label for="entregadorTelefone" class="required">Telefone</label>
                        <input type="text" id="entregadorTelefone" placeholder="(00) 00000-0000" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="entregadorCpf">CPF</label>
                        <input type="text" id="entregadorCpf" placeholder="000.000.000-00">
                    </div>
                    <div class="form-group">
                        <label for="entregadorVeiculo">Veículo</label>
                        <select id="entregadorVeiculo">
                            <option value="moto">Moto</option>
                            <option value="carro">Carro</option>
                            <option value="bicicleta">Bicicleta</option>
                            <option value="caminhao">Caminhão</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="entregadorComissao">Comissão por Entrega (R$)</label>
                        <input type="number" id="entregadorComissao" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="entregadorStatus">Status</label>
                        <select id="entregadorStatus">
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Entregador
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Nova Mercadoria -->
    <div class="modal" id="modalMercadoria">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Mercadoria</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="formMercadoria">
                <div class="form-row">
                    <div class="form-group">
                        <label for="mercadoriaCodigo">Código *</label>
                        <input type="text" id="mercadoriaCodigo" required>
                    </div>
                    <div class="form-group">
                        <label for="mercadoriaEmpresa">Empresa *</label>
                        <select id="mercadoriaEmpresa" required>
                            <!-- As empresas serão carregadas aqui via JavaScript -->
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="mercadoriaDescricao">Descrição *</label>
                    <input type="text" id="mercadoriaDescricao" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mercadoriaDestinatario">Destinatário *</label>
                        <input type="text" id="mercadoriaDestinatario" required>
                    </div>
                    <div class="form-group">
                        <label for="mercadoriaEndereco">Endereço de Entrega *</label>
                        <input type="text" id="mercadoriaEndereco" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mercadoriaValor">Valor da Entrega (R$) *</label>
                        <input type="number" id="mercadoriaValor" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="mercadoriaStatus">Status *</label>
                        <select id="mercadoriaStatus" required>
                            <option value="pendente">Pendente</option>
                            <option value="entregue">Entregue</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Mercadoria
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Nova Entrega -->
    <div class="modal" id="modalEntrega">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Entrega</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="formEntrega">
                <div class="form-row">
                    <div class="form-group">
                        <label for="entregaEmpresa">Empresa *</label>
                        <select id="entregaEmpresa" required>
                            <!-- As empresas serão carregadas aqui via JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="entregaEntregador">Entregador *</label>
                        <select id="entregaEntregador" required>
                            <!-- Os entregadores serão carregados aqui via JavaScript -->
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="entregaMercadoria">Mercadoria *</label>
                        <select id="entregaMercadoria" required>
                            <!-- As mercadorias serão carregadas aqui via JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="entregaRota">Rota *</label>
                        <input type="text" id="entregaRota" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="entregaData">Data de Entrega *</label>
                        <input type="date" id="entregaData" required>
                    </div>
                    <div class="form-group">
                        <label for="entregaStatus">Status *</label>
                        <select id="entregaStatus" required>
                            <option value="pendente">Pendente</option>
                            <option value="em-andamento">Em Andamento</option>
                            <option value="entregue">Entregue</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Entrega
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Novo Lançamento Financeiro -->
    <div class="modal" id="modalLancamento">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Lançamento Financeiro</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="formLancamento">
                <div class="form-row">
                    <div class="form-group">
                        <label for="lancamentoData">Data *</label>
                        <input type="date" id="lancamentoData" required>
                    </div>
                    <div class="form-group">
                        <label for="lancamentoTipo">Tipo *</label>
                        <select id="lancamentoTipo" required>
                            <option value="entrada">Entrada</option>
                            <option value="saida">Saída</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="lancamentoDescricao">Descrição *</label>
                    <input type="text" id="lancamentoDescricao" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="lancamentoCategoria">Categoria *</label>
                        <select id="lancamentoCategoria" required>
                            <option value="Receita">Receita</option>
                            <option value="Despesa">Despesa</option>
                            <option value="Investimento">Investimento</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lancamentoValor">Valor (R$) *</label>
                        <input type="number" id="lancamentoValor" step="0.01" min="0" required>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Lançamento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Detalhes da Entrega -->
    <div class="modal" id="modalDetalhesEntrega">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Detalhes da Entrega</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div id="detalhesEntregaContent">
                <!-- Conteúdo será carregado dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Modal Gerar Recibo -->
    <div class="modal" id="modalGerarRecibo">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Gerar Recibo Avulso</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="formRecibo">
                <div class="form-row">
                    <div class="form-group">
                        <label for="reciboNumero">Número do Recibo *</label>
                        <input type="text" id="reciboNumero" required>
                    </div>
                    <div class="form-group">
                        <label for="reciboData">Data *</label>
                        <input type="date" id="reciboData" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="reciboEmitente">Emitente *</label>
                    <input type="text" id="reciboEmitente" required>
                </div>
                <div class="form-group">
                    <label for="reciboDestinatario">Destinatário *</label>
                    <input type="text" id="reciboDestinatario" required>
                </div>
                <div class="form-group">
                    <label for="reciboDescricao">Descrição *</label>
                    <textarea id="reciboDescricao" rows="3" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="reciboValor">Valor (R$) *</label>
                        <input type="number" id="reciboValor" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="reciboTipo">Tipo *</label>
                        <select id="reciboTipo" required>
                            <option value="recebimento">Recebimento</option>
                            <option value="pagamento">Pagamento</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-receipt"></i> Gerar Recibo
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Confirmação Limpeza -->
    <div class="modal" id="modalConfirmacaoLimpeza">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Confirmar Limpeza do Sistema</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 60px; color: var(--danger); margin-bottom: 20px;">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 style="color: var(--danger); margin-bottom: 15px;">Atenção!</h3>
                <p style="margin-bottom: 20px;">Esta ação irá <strong>remover permanentemente</strong> todos os dados do sistema. Esta operação não pode ser desfeita.</p>
                <p style="margin-bottom: 25px;">Tem certeza que deseja continuar?</p>
                
                <div class="form-group" style="text-align: left; background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <label>
                        <input type="checkbox" id="confirmacaoLimpeza"> 
                        <strong>Sim, eu entendo que todos os dados serão perdidos permanentemente</strong>
                    </label>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="btn btn-secondary" id="btnCancelarLimpeza">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button class="btn btn-danger" id="btnConfirmarLimpeza" disabled>
                        <i class="fas fa-trash"></i> Confirmar Limpeza
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications Container -->
    <div class="toast-container"></div>

    <script>
        // Estrutura de dados vazia
        const emptyData = {
            empresas: [],
            entregadores: [],
            mercadorias: [],
            entregas: [],
            financeiro: {
                receitas: [],
                despesas: []
            },
            logs: [],
            config: {
                inactivityTimeout: 60000,
                autoBackup: true,
                autoLogout: true,
                notifEntregas: true,
                notifFinanceiro: true,
                notifSistema: false,
                notifEmail: false,
                lastBackup: null,
                systemInitialized: true
            }
        };

        // Variáveis de controle
        let systemData = {};
        let inactivityTimer;
        let currentChart = null;
        let autoBackupInterval;

        // Inicialização do sistema
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
            setupEventListeners();
            startInactivityTimer();
            startAutoBackup();
            showToast('Sistema Iniciado', 'LogiTrack Pro carregado com sucesso!', 'success');
        });

        // Inicializar sistema
        function initializeSystem() {
            loadDataFromStorage();
            initializeCharts();
            renderAllData();
            updateConfigDisplay();
        }

        // Carregar dados do localStorage
        function loadDataFromStorage() {
            const savedData = localStorage.getItem('logitrack_data');
            if (savedData) {
                systemData = JSON.parse(savedData);
                if (!systemData.config || !systemData.config.systemInitialized) {
                    systemData = JSON.parse(JSON.stringify(emptyData));
                    saveDataToStorage();
                }
            } else {
                systemData = JSON.parse(JSON.stringify(emptyData));
                saveDataToStorage();
            }
        }

        // Salvar dados no localStorage
        function saveDataToStorage() {
            localStorage.setItem('logitrack_data', JSON.stringify(systemData));
        }

        // Configurar gráficos
        function initializeCharts() {
            // Gráfico de entregas
            const entregasCtx = document.getElementById('entregasChart');
            if (entregasCtx) {
                // Destruir gráfico anterior se existir
                if (currentChart) {
                    currentChart.destroy();
                }
                
                const entregasPorDia = calcularEntregasPorDia();
                
                currentChart = new Chart(entregasCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
                        datasets: [{
                            label: 'Entregas Realizadas',
                            data: entregasPorDia,
                            backgroundColor: 'rgba(67, 97, 238, 0.7)',
                            borderColor: 'rgba(67, 97, 238, 1)',
                            borderWidth: 1,
                            borderRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            // Gráfico financeiro
            const financeiroCtx = document.getElementById('financeiroChart');
            if (financeiroCtx) {
                const dadosFinanceiros = calcularDadosFinanceiros();
                
                new Chart(financeiroCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                        datasets: [{
                            label: 'Receitas',
                            data: dadosFinanceiros.receitas,
                            borderColor: 'rgba(76, 201, 240, 1)',
                            backgroundColor: 'rgba(76, 201, 240, 0.1)',
                            tension: 0.3,
                            fill: true
                        }, {
                            label: 'Despesas',
                            data: dadosFinanceiros.despesas,
                            borderColor: 'rgba(230, 57, 70, 1)',
                            backgroundColor: 'rgba(230, 57, 70, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }

        // Calcular entregas por dia
        function calcularEntregasPorDia() {
            const hoje = new Date();
            const dias = [];
            
            for (let i = 6; i >= 0; i--) {
                const data = new Date(hoje);
                data.setDate(hoje.getDate() - i);
                const dataStr = data.toISOString().split('T')[0];
                
                const entregasDia = systemData.entregas.filter(e => e.data === dataStr).length;
                dias.push(entregasDia);
            }
            
            return dias;
        }

        // Calcular dados financeiros
        function calcularDadosFinanceiros() {
            const receitas = [0, 0, 0, 0, 0, 0];
            const despesas = [0, 0, 0, 0, 0, 0];
            
            // Calcular receitas das entregas
            systemData.entregas.forEach(entrega => {
                if (entrega.status === 'entregue') {
                    const empresa = systemData.empresas.find(e => e.id === entrega.empresaId);
                    if (empresa) {
                        const mes = new Date(entrega.data).getMonth();
                        if (mes >= 0 && mes < 6) {
                            receitas[mes] += empresa.valorEntrega || 0;
                        }
                    }
                }
            });
            
            // Calcular despesas com entregadores
            systemData.entregas.forEach(entrega => {
                if (entrega.status === 'entregue') {
                    const entregador = systemData.entregadores.find(e => e.id === entrega.entregadorId);
                    if (entregador) {
                        const mes = new Date(entrega.data).getMonth();
                        if (mes >= 0 && mes < 6) {
                            despesas[mes] += entregador.comissao || 0;
                        }
                    }
                }
            });
            
            return { receitas, despesas };
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Navegação entre abas
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    document.querySelectorAll('.sidebar-menu a').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                    
                    document.querySelector('.header h1').textContent = this.querySelector('.menu-text').textContent;
                    
                    resetInactivityTimer();
                });
            });

            // Navegação entre subtabs (entregas)
            document.querySelectorAll('.tab[data-subtab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    
                    document.querySelectorAll('.subtab-content').forEach(subtab => {
                        subtab.classList.remove('active');
                    });
                    
                    const subtabId = this.getAttribute('data-subtab');
                    document.getElementById(subtabId).classList.add('active');
                    
                    resetInactivityTimer();
                });
            });

            // Toggle sidebar
            document.querySelector('.toggle-sidebar').addEventListener('click', function() {
                document.querySelector('.sidebar').classList.toggle('collapsed');
                resetInactivityTimer();
            });

            // Botões para abrir modais
            document.getElementById('btnNovaEmpresa').addEventListener('click', function() {
                openModal('modalEmpresa');
            });

            document.getElementById('btnNovoEntregador').addEventListener('click', function() {
                openModal('modalEntregador');
            });

            document.getElementById('btnNovaMercadoria').addEventListener('click', function() {
                populateEmpresasSelect('mercadoriaEmpresa');
                openModal('modalMercadoria');
            });

            document.getElementById('btnNovaEntrega').addEventListener('click', function() {
                openModalEntrega();
            });

            document.getElementById('btnNovaEntrega2').addEventListener('click', function() {
                openModalEntrega();
            });

            document.getElementById('btnNovoLancamento').addEventListener('click', function() {
                openModal('modalLancamento');
            });

            document.getElementById('btnGerarRecibo').addEventListener('click', function() {
                openModal('modalGerarRecibo');
            });

            document.getElementById('btnScanner').addEventListener('click', function() {
                const scannerContainer = document.getElementById('scannerContainer');
                scannerContainer.style.display = scannerContainer.style.display === 'none' ? 'block' : 'none';
            });

            // Backup e limpeza
            document.getElementById('btnBackupNow').addEventListener('click', function() {
                performBackup();
            });

            document.getElementById('btnRestoreBackup').addEventListener('click', function() {
                restoreBackup();
            });

            document.getElementById('backupFileInput').addEventListener('change', function(e) {
                importBackup(e);
            });

            document.getElementById('btnLimparDados').addEventListener('click', function() {
                openModal('modalConfirmacaoLimpeza');
            });

            document.getElementById('btnLimparLogs').addEventListener('click', function() {
                clearLogs();
            });

            document.getElementById('confirmacaoLimpeza').addEventListener('change', function() {
                document.getElementById('btnConfirmarLimpeza').disabled = !this.checked;
            });

            document.getElementById('btnConfirmarLimpeza').addEventListener('click', function() {
                clearSystemData();
            });

            document.getElementById('btnCancelarLimpeza').addEventListener('click', function() {
                document.getElementById('modalConfirmacaoLimpeza').style.display = 'none';
                document.getElementById('confirmacaoLimpeza').checked = false;
                document.getElementById('btnConfirmarLimpeza').disabled = true;
            });

            // Configurações
            document.getElementById('inactivityTimeout').addEventListener('change', function() {
                systemData.config.inactivityTimeout = this.value * 60000;
                saveDataToStorage();
                resetInactivityTimer();
                showToast('Configuração Salva', 'Tempo de inatividade atualizado', 'success');
            });

            document.getElementById('autoBackup').addEventListener('change', function() {
                systemData.config.autoBackup = this.value === 'enabled';
                saveDataToStorage();
                startAutoBackup();
                showToast('Configuração Salva', 'Backup automático ' + (systemData.config.autoBackup ? 'habilitado' : 'desabilitado'), 'success');
            });

            document.getElementById('autoLogout').addEventListener('change', function() {
                systemData.config.autoLogout = this.value === 'enabled';
                saveDataToStorage();
                showToast('Configuração Salva', 'Logout automático ' + (systemData.config.autoLogout ? 'habilitado' : 'desabilitado'), 'success');
            });

            // Notificações
            document.getElementById('notifEntregas').addEventListener('change', function() {
                systemData.config.notifEntregas = this.checked;
                saveDataToStorage();
            });

            document.getElementById('notifFinanceiro').addEventListener('change', function() {
                systemData.config.notifFinanceiro = this.checked;
                saveDataToStorage();
            });

            document.getElementById('notifSistema').addEventListener('change', function() {
                systemData.config.notifSistema = this.checked;
                saveDataToStorage();
            });

            document.getElementById('notifEmail').addEventListener('change', function() {
                systemData.config.notifEmail = this.checked;
                saveDataToStorage();
            });

            // Modal de inatividade
            document.getElementById('btnStayActive').addEventListener('click', function() {
                document.getElementById('inactivityModal').style.display = 'none';
                showToast('Sessão Ativa', 'Você escolheu continuar no sistema', 'warning');
                resetInactivityTimer();
            });

            document.getElementById('btnLogout').addEventListener('click', function() {
                if (systemData.config.autoBackup) {
                    performBackup();
                }
                document.getElementById('inactivityModal').style.display = 'none';
                showToast('Sessão Encerrada', 'Backup realizado. Redirecionando...', 'success');
                
                setTimeout(() => {
                    alert('Sessão encerrada. Até logo!');
                }, 2000);
            });

            // Fechar modais
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });

            // Fechar modais ao clicar fora
            window.addEventListener('click', function(e) {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });

            // Formulários
            document.getElementById('formEmpresa').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEmpresa();
            });

            document.getElementById('formEntregador').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEntregador();
            });

            document.getElementById('formMercadoria').addEventListener('submit', function(e) {
                e.preventDefault();
                saveMercadoria();
            });

            document.getElementById('formEntrega').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEntrega();
            });

            document.getElementById('formLancamento').addEventListener('submit', function(e) {
                e.preventDefault();
                saveLancamento();
            });

            document.getElementById('formRecibo').addEventListener('submit', function(e) {
                e.preventDefault();
                gerarReciboAvulso();
            });

            // Scanner
            document.getElementById('btnIniciarScanner').addEventListener('click', function() {
                startScanner();
            });

            document.getElementById('btnPararScanner').addEventListener('click', function() {
                stopScanner();
            });

            // Relatórios
            document.getElementById('btnGerarRelatorio').addEventListener('click', function() {
                generatePDFReport();
            });

            document.getElementById('btnImprimirRelatorio').addEventListener('click', function() {
                window.print();
            });

            // Buscas e filtros
            document.getElementById('searchEmpresas').addEventListener('input', filterEmpresas);
            document.getElementById('filterEmpresas').addEventListener('change', filterEmpresas);
            
            document.getElementById('searchEntregadores').addEventListener('input', filterEntregadores);
            document.getElementById('filterEntregadores').addEventListener('change', filterEntregadores);
            
            document.getElementById('searchMercadorias').addEventListener('input', filterMercadorias);
            document.getElementById('filterMercadorias').addEventListener('change', filterMercadorias);

            // Detectar atividade do usuário
            document.addEventListener('mousemove', resetInactivityTimer);
            document.addEventListener('keypress', resetInactivityTimer);
            document.addEventListener('click', resetInactivityTimer);
            document.addEventListener('scroll', resetInactivityTimer);
        }

        // Atualizar display das configurações
        function updateConfigDisplay() {
            if (systemData.config.lastBackup) {
                document.getElementById('ultimoBackup').textContent = systemData.config.lastBackup;
            }
            
            document.getElementById('inactivityTimeout').value = systemData.config.inactivityTimeout / 60000;
            document.getElementById('autoBackup').value = systemData.config.autoBackup ? 'enabled' : 'disabled';
            document.getElementById('autoLogout').value = systemData.config.autoLogout ? 'enabled' : 'disabled';
            document.getElementById('notifEntregas').checked = systemData.config.notifEntregas;
            document.getElementById('notifFinanceiro').checked = systemData.config.notifFinanceiro;
            document.getElementById('notifSistema').checked = systemData.config.notifSistema;
            document.getElementById('notifEmail').checked = systemData.config.notifEmail;
        }

        // Renderizar todos os dados
        function renderAllData() {
            renderEmpresas();
            renderEntregadores();
            renderMercadorias();
            renderEntregas();
            renderFinanceiro();
            renderRelatorios();
            renderLogs();
            updateDashboard();
        }

        // Renderizar empresas
        function renderEmpresas() {
            const tbody = document.querySelector('#empresasTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (systemData.empresas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-building"></i>
                            <p>Nenhuma empresa cadastrada</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            systemData.empresas.forEach(empresa => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${empresa.nome}</td>
                    <td>${empresa.cnpj || '-'}</td>
                    <td>${empresa.email || '-'}</td>
                    <td>${empresa.telefone}</td>
                    <td>${empresa.pagamento ? empresa.pagamento + ' dias' : '-'}</td>
                    <td>${empresa.valorEntrega ? 'R$ ' + empresa.valorEntrega.toFixed(2) : '-'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-primary btn-sm" onclick="editEmpresa(${empresa.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEmpresa(${empresa.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Renderizar entregadores
        function renderEntregadores() {
            const tbody = document.querySelector('#entregadoresTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (systemData.entregadores.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-users"></i>
                            <p>Nenhum entregador cadastrada</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            systemData.entregadores.forEach(entregador => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${entregador.nome}</td>
                    <td>${entregador.cpf || '-'}</td>
                    <td>${entregador.telefone}</td>
                    <td>${entregador.veiculo ? entregador.veiculo.charAt(0).toUpperCase() + entregador.veiculo.slice(1) : '-'}</td>
                    <td>${entregador.comissao ? 'R$ ' + entregador.comissao.toFixed(2) + '/entrega' : '-'}</td>
                    <td><span class="status ${entregador.status || 'ativo'}">${(entregador.status || 'ativo') === 'ativo' ? 'Ativo' : 'Inativo'}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-primary btn-sm" onclick="editEntregador(${entregador.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEntregador(${entregador.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Renderizar mercadorias
        function renderMercadorias() {
            const tbody = document.querySelector('#mercadoriasTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (systemData.mercadorias.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-box"></i>
                            <p>Nenhuma mercadoria cadastrada</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            systemData.mercadorias.forEach(mercadoria => {
                const empresa = systemData.empresas.find(e => e.id === mercadoria.empresaId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${mercadoria.codigo}</td>
                    <td>${mercadoria.descricao}</td>
                    <td>${empresa ? empresa.nome : 'N/A'}</td>
                    <td>${mercadoria.destinatario}</td>
                    <td>${formatDate(mercadoria.dataRecebimento)}</td>
                    <td><span class="status ${mercadoria.status}">${mercadoria.status}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-primary btn-sm" onclick="editMercadoria(${mercadoria.id})">
                            <i class="fas fa-eye"></i> Detalhes
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="updateMercadoriaStatus(${mercadoria.id}, 'entregue')">
                            <i class="fas fa-check"></i> Dar Baixa
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Renderizar entregas
        function renderEntregas() {
            renderEntregasTable('entregasTable', systemData.entregas);
            renderEntregasTable('entregasPendentesTable', systemData.entregas.filter(e => e.status === 'pendente'));
            renderEntregasTable('entregasAndamentoTable', systemData.entregas.filter(e => e.status === 'em-andamento'));
            renderEntregasTable('entregasEntreguesTable', systemData.entregas.filter(e => e.status === 'entregue'));
            renderEntregasTable('entregasCanceladasTable', systemData.entregas.filter(e => e.status === 'cancelado'));
        }

        function renderEntregasTable(tableId, entregas) {
            const tbody = document.querySelector(`#${tableId} tbody`);
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (entregas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-shipping-fast"></i>
                            <p>Nenhuma entrega encontrada</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            entregas.forEach(entrega => {
                const empresa = systemData.empresas.find(e => e.id === entrega.empresaId);
                const entregador = systemData.entregadores.find(e => e.id === entrega.entregadorId);
                
                let acoes = '';
                if (entrega.status === 'pendente') {
                    acoes = `<button class="btn btn-secondary btn-sm" onclick="iniciarEntrega(${entrega.id})">
                                <i class="fas fa-play"></i> Iniciar Entrega
                            </button>`;
                } else if (entrega.status === 'em-andamento') {
                    acoes = `<button class="btn btn-primary btn-sm" onclick="finalizarEntrega(${entrega.id})">
                                <i class="fas fa-check"></i> Dar Baixa
                            </button>`;
                } else {
                    acoes = `<button class="btn btn-primary btn-sm" onclick="verDetalhesEntrega(${entrega.id})">
                                <i class="fas fa-eye"></i> Detalhes
                            </button>`;
                }
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${entrega.codigo}</td>
                    <td>${empresa ? empresa.nome : 'N/A'}</td>
                    <td>${entregador ? entregador.nome : 'N/A'}</td>
                    <td>${formatDate(entrega.data)}</td>
                    <td><span class="status ${entrega.status}">${getStatusText(entrega.status)}</span></td>
                    <td class="action-buttons">${acoes}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Renderizar financeiro
        function renderFinanceiro() {
            // Calcular totais
            const totalReceber = systemData.entregas
                .filter(e => e.status === 'entregue')
                .reduce((total, entrega) => {
                    const empresa = systemData.empresas.find(e => e.id === entrega.empresaId);
                    return total + (empresa ? (empresa.valorEntrega || 0) : 0);
                }, 0);
                
            const totalPagar = systemData.entregas
                .filter(e => e.status === 'entregue')
                .reduce((total, entrega) => {
                    const entregador = systemData.entregadores.find(e => e.id === entrega.entregadorId);
                    return total + (entregador ? (entregador.comissao || 0) : 0);
                }, 0);
                
            const totalLucro = totalReceber - totalPagar;
            
            // Atualizar cards
            document.getElementById('valorReceberFinanceiro').textContent = `R$ ${totalReceber.toFixed(2)}`;
            document.getElementById('valorPagarFinanceiro').textContent = `R$ ${totalPagar.toFixed(2)}`;
            document.getElementById('valorLucroFinanceiro').textContent = `R$ ${totalLucro.toFixed(2)}`;
            
            // Renderizar fluxo de caixa
            const tbody = document.querySelector('#fluxoCaixaTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Combinar receitas e despesas
            const fluxo = [...systemData.financeiro.receitas, ...systemData.financeiro.despesas]
                .sort((a, b) => new Date(b.data) - new Date(a.data));
                
            if (fluxo.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-money-bill-wave"></i>
                            <p>Nenhum lançamento financeiro</p>
                        </td>
                    </tr>
                `;
                return;
            }
                
            fluxo.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formatDate(item.data)}</td>
                    <td>${item.descricao}</td>
                    <td>${item.categoria}</td>
                    <td>R$ ${item.valor.toFixed(2)}</td>
                    <td><span style="color: ${item.tipo === 'entrada' ? 'var(--success)' : 'var(--danger)'};">${item.tipo === 'entrada' ? 'Entrada' : 'Saída'}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-danger btn-sm" onclick="deleteLancamento(${item.id}, '${item.tipo}')">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Renderizar relatórios
        function renderRelatorios() {
            document.getElementById('totalEmpresas').textContent = `${systemData.empresas.length} empresas`;
            document.getElementById('totalEntregadores').textContent = `${systemData.entregadores.length} entregadores`;
            
            // Relatório por empresa
            renderRelatorioEmpresas();
            
            // Relatório por entregador
            renderRelatorioEntregadores();
            
            // Ranking de entregadores
            renderRankingEntregadores();
        }

        function renderRelatorioEmpresas() {
            const tbody = document.querySelector('#relatorioEmpresasTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            let totalEntregas = 0;
            let totalRecebido = 0;
            let totalComissao = 0;
            let totalLucro = 0;
            
            systemData.empresas.forEach(empresa => {
                const entregasEmpresa = systemData.entregas.filter(e => 
                    e.empresaId === empresa.id && e.status === 'entregue'
                );
                
                const valorRecebido = entregasEmpresa.length * (empresa.valorEntrega || 0);
                const comissaoPaga = entregasEmpresa.reduce((total, entrega) => {
                    const entregador = systemData.entregadores.find(e => e.id === entrega.entregadorId);
                    return total + (entregador ? (entregador.comissao || 0) : 0);
                }, 0);
                
                const lucro = valorRecebido - comissaoPaga;
                
                totalEntregas += entregasEmpresa.length;
                totalRecebido += valorRecebido;
                totalComissao += comissaoPaga;
                totalLucro += lucro;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${empresa.nome}</td>
                    <td>${entregasEmpresa.length}</td>
                    <td>R$ ${valorRecebido.toFixed(2)}</td>
                    <td>R$ ${comissaoPaga.toFixed(2)}</td>
                    <td>R$ ${lucro.toFixed(2)}</td>
                `;
                tbody.appendChild(tr);
            });
            
            // Atualizar cards
            document.getElementById('totalEntregasEmpresas').textContent = `${totalEntregas} entregas`;
            document.getElementById('receitaTotalEmpresas').textContent = `R$ ${totalRecebido.toFixed(2)}`;
            
            // Adicionar linha de total
            const tr = document.createElement('tr');
            tr.style.fontWeight = 'bold';
            tr.innerHTML = `
                <td>Total</td>
                <td>${totalEntregas}</td>
                <td>R$ ${totalRecebido.toFixed(2)}</td>
                <td>R$ ${totalComissao.toFixed(2)}</td>
                <td>R$ ${totalLucro.toFixed(2)}</td>
            `;
            tbody.appendChild(tr);
        }

        function renderRelatorioEntregadores() {
            const tbody = document.querySelector('#relatorioEntregadoresTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            let totalEntregas = 0;
            let totalComissao = 0;
            
            systemData.entregadores.forEach(entregador => {
                const entregasEntregador = systemData.entregas.filter(e => 
                    e.entregadorId === entregador.id && e.status === 'entregue'
                );
                
                const comissaoTotal = entregasEntregador.length * (entregador.comissao || 0);
                
                totalEntregas += entregasEntregador.length;
                totalComissao += comissaoTotal;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${entregador.nome}</td>
                    <td>${entregasEntregador.length}</td>
                    <td>R$ ${comissaoTotal.toFixed(2)}</td>
                    <td><span class="status ${entregador.status || 'ativo'}">${(entregador.status || 'ativo') === 'ativo' ? 'Ativo' : 'Inativo'}</span></td>
                `;
                tbody.appendChild(tr);
            });
            
            // Atualizar cards
            document.getElementById('totalEntregasEntregadores').textContent = `${totalEntregas} entregas`;
            document.getElementById('comissaoTotalEntregadores').textContent = `R$ ${totalComissao.toFixed(2)}`;
        }

        function renderRankingEntregadores() {
            const tbody = document.querySelector('#rankingEntregadoresTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Calcular entregas por entregador
            const entregadoresComEntregas = systemData.entregadores.map(entregador => {
                const entregasEntregador = systemData.entregas.filter(e => 
                    e.entregadorId === entregador.id && e.status === 'entregue'
                );
                
                const comissaoTotal = entregasEntregador.length * (entregador.comissao || 0);
                
                return {
                    ...entregador,
                    entregas: entregasEntregador.length,
                    comissaoTotal: comissaoTotal
                };
            });
            
            // Ordenar por número de entregas (decrescente)
            entregadoresComEntregas.sort((a, b) => b.entregas - a.entregas);
            
            // Atualizar cards
            const topEntregador = entregadoresComEntregas.length > 0 ? entregadoresComEntregas[0].nome : '-';
            const mediaEntregas = entregadoresComEntregas.length > 0 ? 
                Math.round(entregadoresComEntregas.reduce((sum, e) => sum + e.entregas, 0) / entregadoresComEntregas.length) : 0;
            const entregadoresAtivos = entregadoresComEntregas.filter(e => e.entregas > 0).length;
            
            document.getElementById('topEntregador').textContent = topEntregador;
            document.getElementById('mediaEntregas').textContent = mediaEntregas;
            document.getElementById('entregadoresAtivos').textContent = entregadoresAtivos;
            
            // Renderizar ranking
            if (entregadoresComEntregas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-trophy"></i>
                            <p>Nenhum entregador com entregas realizadas</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            entregadoresComEntregas.forEach((entregador, index) => {
                let badgeClass = '';
                if (index === 0) badgeClass = 'gold';
                else if (index === 1) badgeClass = 'silver';
                else if (index === 2) badgeClass = 'bronze';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <span class="ranking-badge ${badgeClass}">${index + 1}</span>
                    </td>
                    <td>${entregador.nome}</td>
                    <td>${entregador.entregas}</td>
                    <td>R$ ${entregador.comissaoTotal.toFixed(2)}</td>
                    <td><span class="status ${entregador.status || 'ativo'}">${(entregador.status || 'ativo') === 'ativo' ? 'Ativo' : 'Inativo'}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Renderizar logs
        function renderLogs() {
            const tbody = document.querySelector('#logsTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (systemData.logs.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <p>Nenhum log registrado</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            systemData.logs.forEach(log => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formatDateTime(log.data)}</td>
                    <td>${log.usuario}</td>
                    <td>${log.acao}</td>
                    <td>${log.detalhes}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Atualizar dashboard
        function updateDashboard() {
            const hoje = new Date().toISOString().split('T')[0];
            const entregasHoje = systemData.entregas.filter(e => e.data === hoje).length;
            
            document.getElementById('entregasHoje').textContent = entregasHoje;
            
            // Calcular valores financeiros
            const totalReceber = systemData.entregas
                .filter(e => e.status === 'entregue')
                .reduce((total, entrega) => {
                    const empresa = systemData.empresas.find(e => e.id === entrega.empresaId);
                    return total + (empresa ? (empresa.valorEntrega || 0) : 0);
                }, 0);
                
            const totalPagar = systemData.entregas
                .filter(e => e.status === 'entregue')
                .reduce((total, entrega) => {
                    const entregador = systemData.entregadores.find(e => e.id === entrega.entregadorId);
                    return total + (entregador ? (entregador.comissao || 0) : 0);
                }, 0);
                
            const totalLucro = totalReceber - totalPagar;
            
            document.getElementById('valorReceber').textContent = `R$ ${totalReceber.toFixed(2)}`;
            document.getElementById('valorPagar').textContent = `R$ ${totalPagar.toFixed(2)}`;
            document.getElementById('valorLucro').textContent = `R$ ${totalLucro.toFixed(2)}`;
        }

        // Sistema de inatividade
        function startInactivityTimer() {
            if (systemData.config.autoLogout) {
                inactivityTimer = setTimeout(showInactivityModal, systemData.config.inactivityTimeout);
            }
        }

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            startInactivityTimer();
        }

        function showInactivityModal() {
            document.getElementById('inactivityModal').style.display = 'flex';
        }

        // Sistema de backup automático
        function startAutoBackup() {
            // Limpar intervalo anterior se existir
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
            }
            
            // Se backup automático estiver habilitado, configurar intervalo
            if (systemData.config.autoBackup) {
                // Fazer backup a cada 5 minutos (300000 ms)
                autoBackupInterval = setInterval(() => {
                    performAutoBackup();
                }, 300000); // 5 minutos
            }
        }

        function performAutoBackup() {
            const backupData = {
                timestamp: new Date().toISOString(),
                data: systemData
            };
            
            localStorage.setItem('logitrack_backup', JSON.stringify(backupData));
            
            systemData.config.lastBackup = new Date().toLocaleString('pt-BR');
            document.getElementById('ultimoBackup').textContent = systemData.config.lastBackup;
            saveDataToStorage();
            
            addLog('Backup Automático', 'Backup automático realizado com sucesso');
            console.log('Backup automático realizado em:', new Date().toLocaleString('pt-BR'));
        }

        // Sistema de backup manual
        function performBackup() {
            showToast('Backup Iniciado', 'Realizando backup dos dados...', 'success');
            
            setTimeout(() => {
                const backupData = {
                    timestamp: new Date().toISOString(),
                    data: systemData
                };
                
                // Salvar backup no localStorage
                localStorage.setItem('logitrack_backup', JSON.stringify(backupData));
                
                // Criar arquivo JSON para download
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `logitrack_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                systemData.config.lastBackup = new Date().toLocaleString('pt-BR');
                document.getElementById('ultimoBackup').textContent = systemData.config.lastBackup;
                saveDataToStorage();
                
                addLog('Backup do Sistema', 'Backup manual realizado com sucesso');
                showToast('Backup Concluído', 'Dados salvos e arquivo baixado com sucesso!', 'success');
            }, 1500);
        }

        function restoreBackup() {
            const backupData = localStorage.getItem('logitrack_backup');
            if (backupData) {
                if (confirm('Restaurar backup? Os dados atuais serão substituídos.')) {
                    try {
                        const backup = JSON.parse(backupData);
                        systemData = backup.data;
                        saveDataToStorage();
                        renderAllData();
                        updateConfigDisplay();
                        
                        addLog('Restauração de Backup', 'Sistema restaurado a partir de backup');
                        showToast('Backup Restaurado', 'Dados restaurados com sucesso!', 'success');
                    } catch (error) {
                        console.error('Erro ao restaurar backup:', error);
                        showToast('Erro ao Restaurar', 'Ocorreu um erro ao restaurar o backup', 'error');
                    }
                }
            } else {
                showToast('Backup Não Encontrado', 'Nenhum backup disponível', 'error');
            }
        }

        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (confirm('Importar backup? Os dados atuais serão substituídos.')) {
                        systemData = backupData.data;
                        saveDataToStorage();
                        renderAllData();
                        updateConfigDisplay();
                        
                        addLog('Importação de Backup', 'Sistema restaurado a partir de arquivo JSON');
                        showToast('Backup Importado', 'Dados importados com sucesso!', 'success');
                    }
                } catch (error) {
                    console.error('Erro ao importar backup:', error);
                    showToast('Erro ao Importar', 'O arquivo selecionado não é válido', 'error');
                }
            };
            reader.readAsText(file);
            
            // Limpar o input para permitir selecionar o mesmo arquivo novamente
            event.target.value = '';
        }

        // Limpeza do sistema
        function clearSystemData() {
            const manterConfig = document.getElementById('manterConfig').checked;
            
            if (manterConfig) {
                // Manter apenas as configurações
                const configBackup = {...systemData.config};
                systemData = JSON.parse(JSON.stringify(emptyData));
                systemData.config = configBackup;
            } else {
                // Limpar tudo
                systemData = JSON.parse(JSON.stringify(emptyData));
            }
            
            systemData.config.systemInitialized = true;
            saveDataToStorage();
            renderAllData();
            updateConfigDisplay();
            
            addLog('Limpeza do Sistema', 'Todos os dados foram limpos');
            showToast('Sistema Limpo', 'Todos os dados foram resetados com sucesso!', 'success');
            
            document.getElementById('modalConfirmacaoLimpeza').style.display = 'none';
            document.getElementById('confirmacaoLimpeza').checked = false;
            document.getElementById('btnConfirmarLimpeza').disabled = true;
        }

        function clearLogs() {
            if (confirm('Limpar todos os logs do sistema?')) {
                systemData.logs = [];
                saveDataToStorage();
                renderLogs();
                
                addLog('Limpeza de Logs', 'Todos os logs foram removidos');
                showToast('Logs Limpos', 'Todos os logs foram removidos!', 'success');
            }
        }

        // Funções para popular selects
        function populateEmpresasSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            select.innerHTML = '';
            
            systemData.empresas.forEach(empresa => {
                const option = document.createElement('option');
                option.value = empresa.id;
                option.textContent = empresa.nome;
                select.appendChild(option);
            });
        }

        function populateEntregadoresSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            select.innerHTML = '';
            
            systemData.entregadores
                .filter(e => (e.status || 'ativo') === 'ativo')
                .forEach(entregador => {
                    const option = document.createElement('option');
                    option.value = entregador.id;
                    option.textContent = entregador.nome;
                    select.appendChild(option);
                });
        }

        function populateMercadoriasSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            select.innerHTML = '';
            
            systemData.mercadorias
                .filter(m => m.status === 'pendente')
                .forEach(mercadoria => {
                    const option = document.createElement('option');
                    option.value = mercadoria.id;
                    option.textContent = `${mercadoria.codigo} - ${mercadoria.descricao}`;
                    select.appendChild(option);
                });
        }

        // Funções para salvar dados
        function saveEmpresa() {
            const novaEmpresa = {
                id: systemData.empresas.length > 0 ? Math.max(...systemData.empresas.map(e => e.id)) + 1 : 1,
                nome: document.getElementById('empresaNome').value,
                telefone: document.getElementById('empresaTelefone').value,
                cnpj: document.getElementById('empresaCnpj').value || null,
                email: document.getElementById('empresaEmail').value || null,
                endereco: document.getElementById('empresaEndereco').value || null,
                pagamento: document.getElementById('empresaPagamento').value || null,
                valorEntrega: document.getElementById('empresaValor').value ? parseFloat(document.getElementById('empresaValor').value) : null
            };
            
            systemData.empresas.push(novaEmpresa);
            saveDataToStorage();
            renderEmpresas();
            
            addLog('Nova Empresa', `Empresa "${novaEmpresa.nome}" cadastrada`);
            showToast('Empresa Salva', `Empresa "${novaEmpresa.nome}" cadastrada com sucesso!`, 'success');
            document.getElementById('formEmpresa').reset();
            document.getElementById('modalEmpresa').style.display = 'none';
        }

        function saveEntregador() {
            const novoEntregador = {
                id: systemData.entregadores.length > 0 ? Math.max(...systemData.entregadores.map(e => e.id)) + 1 : 1,
                nome: document.getElementById('entregadorNome').value,
                telefone: document.getElementById('entregadorTelefone').value,
                cpf: document.getElementById('entregadorCpf').value || null,
                veiculo: document.getElementById('entregadorVeiculo').value || null,
                comissao: document.getElementById('entregadorComissao').value ? parseFloat(document.getElementById('entregadorComissao').value) : null,
                status: document.getElementById('entregadorStatus').value || 'ativo'
            };
            
            systemData.entregadores.push(novoEntregador);
            saveDataToStorage();
            renderEntregadores();
            
            addLog('Novo Entregador', `Entregador "${novoEntregador.nome}" cadastrado`);
            showToast('Entregador Salvo', `Entregador "${novoEntregador.nome}" cadastrado com sucesso!`, 'success');
            document.getElementById('formEntregador').reset();
            document.getElementById('modalEntregador').style.display = 'none';
        }

        function saveMercadoria() {
            const novaMercadoria = {
                id: systemData.mercadorias.length > 0 ? Math.max(...systemData.mercadorias.map(m => m.id)) + 1 : 1,
                codigo: document.getElementById('mercadoriaCodigo').value,
                descricao: document.getElementById('mercadoriaDescricao').value,
                empresaId: parseInt(document.getElementById('mercadoriaEmpresa').value),
                destinatario: document.getElementById('mercadoriaDestinatario').value,
                endereco: document.getElementById('mercadoriaEndereco').value,
                valor: parseFloat(document.getElementById('mercadoriaValor').value),
                dataRecebimento: new Date().toISOString().split('T')[0],
                status: document.getElementById('mercadoriaStatus').value
            };
            
            systemData.mercadorias.push(novaMercadoria);
            saveDataToStorage();
            renderMercadorias();
            
            addLog('Nova Mercadoria', `Mercadoria "${novaMercadoria.descricao}" cadastrada`);
            showToast('Mercadoria Salva', `Mercadoria "${novaMercadoria.descricao}" cadastrada com sucesso!`, 'success');
            document.getElementById('formMercadoria').reset();
            document.getElementById('modalMercadoria').style.display = 'none';
        }

        function saveEntrega() {
            const novaEntrega = {
                id: systemData.entregas.length > 0 ? Math.max(...systemData.entregas.map(e => e.id)) + 1 : 1,
                codigo: `#ENT${String(systemData.entregas.length + 1).padStart(5, '0')}`,
                empresaId: parseInt(document.getElementById('entregaEmpresa').value),
                entregadorId: parseInt(document.getElementById('entregaEntregador').value),
                mercadoriaId: parseInt(document.getElementById('entregaMercadoria').value),
                rota: document.getElementById('entregaRota').value,
                data: document.getElementById('entregaData').value,
                dataSaida: null,
                dataEntrega: null,
                status: document.getElementById('entregaStatus').value
            };
            
            systemData.entregas.push(novaEntrega);
            saveDataToStorage();
            renderEntregas();
            renderFinanceiro();
            
            addLog('Nova Entrega', `Entrega ${novaEntrega.codigo} cadastrada`);
            showToast('Entrega Salva', `Entrega ${novaEntrega.codigo} cadastrada com sucesso!`, 'success');
            document.getElementById('formEntrega').reset();
            document.getElementById('modalEntrega').style.display = 'none';
        }

        function saveLancamento() {
            const tipo = document.getElementById('lancamentoTipo').value;
            const novoLancamento = {
                id: tipo === 'entrada' ? 
                    systemData.financeiro.receitas.length > 0 ? Math.max(...systemData.financeiro.receitas.map(r => r.id)) + 1 : 1 :
                    systemData.financeiro.despesas.length > 0 ? Math.max(...systemData.financeiro.despesas.map(d => d.id)) + 1 : 1,
                data: document.getElementById('lancamentoData').value,
                descricao: document.getElementById('lancamentoDescricao').value,
                categoria: document.getElementById('lancamentoCategoria').value,
                valor: parseFloat(document.getElementById('lancamentoValor').value),
                tipo: tipo
            };
            
            if (tipo === 'entrada') {
                systemData.financeiro.receitas.push(novoLancamento);
            } else {
                systemData.financeiro.despesas.push(novoLancamento);
            }
            
            saveDataToStorage();
            renderFinanceiro();
            
            addLog('Novo Lançamento', `Lançamento "${novoLancamento.descricao}" cadastrado`);
            showToast('Lançamento Salvo', 'Lançamento cadastrado com sucesso!', 'success');
            document.getElementById('formLancamento').reset();
            document.getElementById('modalLancamento').style.display = 'none';
        }

        // Funções para ações nas tabelas
        function iniciarEntrega(entregaId) {
            const entrega = systemData.entregas.find(e => e.id === entregaId);
            if (entrega) {
                entrega.status = 'em-andamento';
                entrega.dataSaida = new Date().toISOString();
                saveDataToStorage();
                renderEntregas();
                
                addLog('Entrega Iniciada', `Entrega ${entrega.codigo} iniciada`);
                showToast('Entrega Iniciada', `Entrega ${entrega.codigo} iniciada com sucesso!`, 'success');
            }
        }

        function finalizarEntrega(entregaId) {
            const entrega = systemData.entregas.find(e => e.id === entregaId);
            if (entrega) {
                entrega.status = 'entregue';
                entrega.dataEntrega = new Date().toISOString();
                saveDataToStorage();
                renderEntregas();
                renderFinanceiro();
                
                addLog('Entrega Finalizada', `Entrega ${entrega.codigo} finalizada`);
                showToast('Entrega Finalizada', `Entrega ${entrega.codigo} finalizada com sucesso!`, 'success');
            }
        }

        function verDetalhesEntrega(entregaId) {
            const entrega = systemData.entregas.find(e => e.id === entregaId);
            if (entrega) {
                const empresa = systemData.empresas.find(e => e.id === entrega.empresaId);
                const entregador = systemData.entregadores.find(e => e.id === entrega.entregadorId);
                const mercadoria = systemData.mercadorias.find(m => m.id === entrega.mercadoriaId);
                
                const detalhesContent = document.getElementById('detalhesEntregaContent');
                detalhesContent.innerHTML = `
                    <div class="recibo-info">
                        <div>
                            <p><strong>Código:</strong> ${entrega.codigo}</p>
                            <p><strong>Status:</strong> <span class="status ${entrega.status}">${getStatusText(entrega.status)}</span></p>
                            <p><strong>Data:</strong> ${formatDate(entrega.data)}</p>
                            <p><strong>Rota:</strong> ${entrega.rota}</p>
                        </div>
                        <div>
                            <p><strong>Empresa:</strong> ${empresa ? empresa.nome : 'N/A'}</p>
                            <p><strong>Entregador:</strong> ${entregador ? entregador.nome : 'N/A'}</p>
                            <p><strong>Mercadoria:</strong> ${mercadoria ? mercadoria.descricao : 'N/A'}</p>
                            <p><strong>Destinatário:</strong> ${mercadoria ? mercadoria.destinatario : 'N/A'}</p>
                        </div>
                    </div>
                    <div class="recibo-section">
                        <h3 class="recibo-section-title">Informações Financeiras</h3>
                        <div class="recibo-item">
                            <span>Valor da Entrega:</span>
                            <span>R$ ${empresa ? (empresa.valorEntrega || 0).toFixed(2) : '0,00'}</span>
                        </div>
                        <div class="recibo-item">
                            <span>Comissão do Entregador:</span>
                            <span>R$ ${entregador ? (entregador.comissao || 0).toFixed(2) : '0,00'}</span>
                        </div>
                        <div class="recibo-total">
                            <span>Lucro:</span>
                            <span>R$ ${(empresa && entregador ? ((empresa.valorEntrega || 0) - (entregador.comissao || 0)).toFixed(2) : '0,00')}</span>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 25px;">
                        <button class="btn btn-primary" onclick="gerarReciboEntrega(${entrega.id})">
                            <i class="fas fa-receipt"></i> Gerar Recibo
                        </button>
                    </div>
                `;
                
                openModal('modalDetalhesEntrega');
            }
        }

        function updateMercadoriaStatus(mercadoriaId, status) {
            const mercadoria = systemData.mercadorias.find(m => m.id === mercadoriaId);
            if (mercadoria) {
                mercadoria.status = status;
                saveDataToStorage();
                renderMercadorias();
                
                addLog('Status Atualizado', `Mercadoria ${mercadoria.codigo} marcada como ${status}`);
                showToast('Status Atualizado', `Mercadoria ${mercadoria.codigo} marcada como ${status}`, 'success');
            }
        }

        function deleteLancamento(lancamentoId, tipo) {
            if (confirm('Excluir este lançamento?')) {
                if (tipo === 'entrada') {
                    systemData.financeiro.receitas = systemData.financeiro.receitas.filter(r => r.id !== lancamentoId);
                } else {
                    systemData.financeiro.despesas = systemData.financeiro.despesas.filter(d => d.id !== lancamentoId);
                }
                saveDataToStorage();
                renderFinanceiro();
                
                addLog('Lançamento Excluído', `Lançamento com ID ${lancamentoId} excluído`);
                showToast('Lançamento Excluído', 'Lançamento excluído com sucesso!', 'success');
            }
        }

        // Scanner (simulado)
        function startScanner() {
            document.getElementById('scanner-result').innerHTML = '<p style="color: var(--success);">Scanner iniciado. Em um ambiente real, esta funcionalidade usaria a câmera para ler códigos de barras e QR Codes.</p>';
            
            setTimeout(() => {
                const codigos = ['7891234567890', '7899876543210', '7894561230987', '7896543210987'];
                const codigoAleatorio = codigos[Math.floor(Math.random() * codigos.length)];
                
                document.getElementById('scanner-result').innerHTML = `
                    <p style="color: var(--success);">Código lido: <strong>${codigoAleatorio}</strong></p>
                    <button class="btn btn-primary" onclick="usarCodigoScanner('${codigoAleatorio}')">Usar este código</button>
                `;
            }, 2000);
        }

        function stopScanner() {
            document.getElementById('scanner-result').innerHTML = '<p style="color: var(--danger);">Scanner parado.</p>';
        }

        function usarCodigoScanner(codigo) {
            document.getElementById('mercadoriaCodigo').value = codigo;
            document.getElementById('scannerContainer').style.display = 'none';
            showToast('Código Adicionado', `Código ${codigo} adicionado ao formulário`, 'success');
        }

        // Gerar recibo avulso
        function gerarReciboAvulso() {
            const reciboNumero = document.getElementById('reciboNumero').value;
            const reciboData = document.getElementById('reciboData').value;
            const reciboEmitente = document.getElementById('reciboEmitente').value;
            const reciboDestinatario = document.getElementById('reciboDestinatario').value;
            const reciboDescricao = document.getElementById('reciboDescricao').value;
            const reciboValor = parseFloat(document.getElementById('reciboValor').value);
            const reciboTipo = document.getElementById('reciboTipo').value;
            
            // Criar conteúdo do recibo
            const reciboContent = document.createElement('div');
            reciboContent.className = 'recibo-container';
            reciboContent.innerHTML = `
                <div class="recibo-header">
                    <h1 class="recibo-title">RECIBO</h1>
                    <p>Nº ${reciboNumero}</p>
                </div>
                
                <div class="recibo-info">
                    <div>
                        <p><strong>Data:</strong> ${formatDate(reciboData)}</p>
                        <p><strong>Emitente:</strong> ${reciboEmitente}</p>
                    </div>
                    <div>
                        <p><strong>Destinatário:</strong> ${reciboDestinatario}</p>
                        <p><strong>Tipo:</strong> ${reciboTipo === 'recebimento' ? 'Recebimento' : 'Pagamento'}</p>
                    </div>
                </div>
                
                <div class="recibo-section">
                    <h3 class="recibo-section-title">Descrição</h3>
                    <p>${reciboDescricao}</p>
                </div>
                
                <div class="recibo-section">
                    <h3 class="recibo-section-title">Valor</h3>
                    <div class="recibo-total">
                        <span>Total:</span>
                        <span>R$ ${reciboValor.toFixed(2)}</span>
                    </div>
                </div>
                
                <div class="qr-code">
                    <i class="fas fa-qrcode"></i>
                </div>
                
                <div class="recibo-footer">
                    <p>_________________________________________</p>
                    <p>Assinatura</p>
                    <p>LogiTrack Pro - Sistema de Gestão Logística</p>
                </div>
            `;
            
            // Gerar PDF
            generatePDF(reciboContent, `recibo_${reciboNumero}.pdf`);
            
            // Fechar modal
            document.getElementById('modalGerarRecibo').style.display = 'none';
            document.getElementById('formRecibo').reset();
            
            addLog('Recibo Gerado', `Recibo avulso ${reciboNumero} gerado`);
            showToast('Recibo Gerado', 'Recibo gerado com sucesso!', 'success');
        }

        // Gerar recibo de entrega
        function gerarReciboEntrega(entregaId) {
            const entrega = systemData.entregas.find(e => e.id === entregaId);
            if (!entrega) return;
            
            const empresa = systemData.empresas.find(e => e.id === entrega.empresaId);
            const entregador = systemData.entregadores.find(e => e.id === entrega.entregadorId);
            const mercadoria = systemData.mercadorias.find(m => m.id === entrega.mercadoriaId);
            
            // Criar conteúdo do recibo
            const reciboContent = document.createElement('div');
            reciboContent.className = 'recibo-container';
            reciboContent.innerHTML = `
                <div class="recibo-header">
                    <h1 class="recibo-title">RECIBO DE ENTREGA</h1>
                    <p>Nº ${entrega.codigo}</p>
                </div>
                
                <div class="recibo-info">
                    <div>
                        <p><strong>Data:</strong> ${formatDate(entrega.data)}</p>
                        <p><strong>Empresa:</strong> ${empresa ? empresa.nome : 'N/A'}</p>
                        <p><strong>Entregador:</strong> ${entregador ? entregador.nome : 'N/A'}</p>
                    </div>
                    <div>
                        <p><strong>Status:</strong> ${getStatusText(entrega.status)}</p>
                        <p><strong>Destinatário:</strong> ${mercadoria ? mercadoria.destinatario : 'N/A'}</p>
                        <p><strong>Rota:</strong> ${entrega.rota}</p>
                    </div>
                </div>
                
                <div class="recibo-section">
                    <h3 class="recibo-section-title">Mercadoria</h3>
                    <p><strong>Código:</strong> ${mercadoria ? mercadoria.codigo : 'N/A'}</p>
                    <p><strong>Descrição:</strong> ${mercadoria ? mercadoria.descricao : 'N/A'}</p>
                    <p><strong>Endereço de Entrega:</strong> ${mercadoria ? mercadoria.endereco : 'N/A'}</p>
                </div>
                
                <div class="recibo-section">
                    <h3 class="recibo-section-title">Valores</h3>
                    <div class="recibo-item">
                        <span>Valor da Entrega:</span>
                        <span>R$ ${empresa ? (empresa.valorEntrega || 0).toFixed(2) : '0,00'}</span>
                    </div>
                    <div class="recibo-item">
                        <span>Comissão do Entregador:</span>
                        <span>R$ ${entregador ? (entregador.comissao || 0).toFixed(2) : '0,00'}</span>
                    </div>
                    <div class="recibo-total">
                        <span>Lucro:</span>
                        <span>R$ ${(empresa && entregador ? ((empresa.valorEntrega || 0) - (entregador.comissao || 0)).toFixed(2) : '0,00')}</span>
                    </div>
                </div>
                
                <div class="qr-code">
                    <i class="fas fa-qrcode"></i>
                </div>
                
                <div class="recibo-footer">
                    <p>_________________________________________</p>
                    <p>Assinatura do Entregador</p>
                    <p>LogiTrack Pro - Sistema de Gestão Logística</p>
                </div>
            `;
            
            // Gerar PDF
            generatePDF(reciboContent, `recibo_entrega_${entrega.codigo}.pdf`);
            
            addLog('Recibo de Entrega Gerado', `Recibo da entrega ${entrega.codigo} gerado`);
            showToast('Recibo Gerado', 'Recibo de entrega gerado com sucesso!', 'success');
        }

        // Gerar PDF
        function generatePDF(content, filename) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            // Adicionar conteúdo ao PDF
            doc.html(content, {
                callback: function(doc) {
                    doc.save(filename);
                },
                x: 10,
                y: 10,
                width: 190,
                windowWidth: 800
            });
        }

        // Gerar relatório PDF
        function generatePDFReport() {
            showToast('Gerando PDF', 'Preparando relatório para download...', 'success');
            
            // Criar conteúdo do relatório
            const reportContent = document.createElement('div');
            reportContent.className = 'recibo-container';
            reportContent.innerHTML = `
                <div class="recibo-header">
                    <h1 class="recibo-title">RELATÓRIO DE ENTREGAS</h1>
                    <p>Período: ${new Date().toLocaleDateString('pt-BR')}</p>
                </div>
                
                <div class="recibo-section">
                    <h3 class="recibo-section-title">Resumo</h3>
                    <div class="recibo-info">
                        <div>
                            <p><strong>Total de Empresas:</strong> ${systemData.empresas.length}</p>
                            <p><strong>Total de Entregadores:</strong> ${systemData.entregadores.length}</p>
                        </div>
                        <div>
                            <p><strong>Total de Mercadorias:</strong> ${systemData.mercadorias.length}</p>
                            <p><strong>Total de Entregas:</strong> ${systemData.entregas.length}</p>
                        </div>
                    </div>
                </div>
                
                <div class="recibo-section">
                    <h3 class="recibo-section-title">Entregas por Status</h3>
                    <div class="recibo-item">
                        <span>Pendentes:</span>
                        <span>${systemData.entregas.filter(e => e.status === 'pendente').length}</span>
                    </div>
                    <div class="recibo-item">
                        <span>Em Andamento:</span>
                        <span>${systemData.entregas.filter(e => e.status === 'em-andamento').length}</span>
                    </div>
                    <div class="recibo-item">
                        <span>Entregues:</span>
                        <span>${systemData.entregas.filter(e => e.status === 'entregue').length}</span>
                    </div>
                    <div class="recibo-item">
                        <span>Canceladas:</span>
                        <span>${systemData.entregas.filter(e => e.status === 'cancelado').length}</span>
                    </div>
                </div>
                
                <div class="recibo-section">
                    <h3 class="recibo-section-title">Resumo Financeiro</h3>
                    <div class="recibo-item">
                        <span>A Receber:</span>
                        <span>R$ ${systemData.entregas.filter(e => e.status === 'entregue').reduce((total, entrega) => {
                            const empresa = systemData.empresas.find(e => e.id === entrega.empresaId);
                            return total + (empresa ? (empresa.valorEntrega || 0) : 0);
                        }, 0).toFixed(2)}</span>
                    </div>
                    <div class="recibo-item">
                        <span>A Pagar:</span>
                        <span>R$ ${systemData.entregas.filter(e => e.status === 'entregue').reduce((total, entrega) => {
                            const entregador = systemData.entregadores.find(e => e.id === entrega.entregadorId);
                            return total + (entregador ? (entregador.comissao || 0) : 0);
                        }, 0).toFixed(2)}</span>
                    </div>
                    <div class="recibo-total">
                        <span>Lucro Estimado:</span>
                        <span>R$ ${(systemData.entregas.filter(e => e.status === 'entregue').reduce((total, entrega) => {
                            const empresa = systemData.empresas.find(e => e.id === entrega.empresaId);
                            return total + (empresa ? (empresa.valorEntrega || 0) : 0);
                        }, 0) - systemData.entregas.filter(e => e.status === 'entregue').reduce((total, entrega) => {
                            const entregador = systemData.entregadores.find(e => e.id === entrega.entregadorId);
                            return total + (entregador ? (entregador.comissao || 0) : 0);
                        }, 0)).toFixed(2)}</span>
                    </div>
                </div>
                
                <div class="recibo-footer">
                    <p>LogiTrack Pro - Sistema de Gestão Logística</p>
                    <p>Relatório gerado em: ${new Date().toLocaleString('pt-BR')}</p>
                </div>
            `;
            
            // Gerar PDF
            generatePDF(reportContent, `relatorio_logitrack_${new Date().toISOString().split('T')[0]}.pdf`);
            
            addLog('Relatório Gerado', 'Relatório PDF gerado e baixado');
            showToast('PDF Gerado', 'Relatório PDF baixado com sucesso!', 'success');
        }

        // Filtros
        function filterEmpresas() {
            const searchTerm = document.getElementById('searchEmpresas').value.toLowerCase();
            const filterValue = document.getElementById('filterEmpresas').value;
            
            const filtered = systemData.empresas.filter(empresa => {
                const matchesSearch = empresa.nome.toLowerCase().includes(searchTerm) || 
                                     (empresa.cnpj && empresa.cnpj.includes(searchTerm)) ||
                                     (empresa.email && empresa.email.toLowerCase().includes(searchTerm));
                
                const matchesFilter = filterValue === '' || empresa.pagamento === filterValue;
                
                return matchesSearch && matchesFilter;
            });
            
            const tbody = document.querySelector('#empresasTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-building"></i>
                            <p>Nenhuma empresa encontrada</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filtered.forEach(empresa => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${empresa.nome}</td>
                    <td>${empresa.cnpj || '-'}</td>
                    <td>${empresa.email || '-'}</td>
                    <td>${empresa.telefone}</td>
                    <td>${empresa.pagamento ? empresa.pagamento + ' dias' : '-'}</td>
                    <td>${empresa.valorEntrega ? 'R$ ' + empresa.valorEntrega.toFixed(2) : '-'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-primary btn-sm" onclick="editEmpresa(${empresa.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEmpresa(${empresa.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filterEntregadores() {
            const searchTerm = document.getElementById('searchEntregadores').value.toLowerCase();
            const filterValue = document.getElementById('filterEntregadores').value;
            
            const filtered = systemData.entregadores.filter(entregador => {
                const matchesSearch = entregador.nome.toLowerCase().includes(searchTerm) || 
                                     (entregador.cpf && entregador.cpf.includes(searchTerm));
                
                const matchesFilter = filterValue === '' || entregador.status === filterValue;
                
                return matchesSearch && matchesFilter;
            });
            
            const tbody = document.querySelector('#entregadoresTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-users"></i>
                            <p>Nenhum entregador encontrado</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filtered.forEach(entregador => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${entregador.nome}</td>
                    <td>${entregador.cpf || '-'}</td>
                    <td>${entregador.telefone}</td>
                    <td>${entregador.veiculo ? entregador.veiculo.charAt(0).toUpperCase() + entregador.veiculo.slice(1) : '-'}</td>
                    <td>${entregador.comissao ? 'R$ ' + entregador.comissao.toFixed(2) + '/entrega' : '-'}</td>
                    <td><span class="status ${entregador.status || 'ativo'}">${(entregador.status || 'ativo') === 'ativo' ? 'Ativo' : 'Inativo'}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-primary btn-sm" onclick="editEntregador(${entregador.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEntregador(${entregador.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filterMercadorias() {
            const searchTerm = document.getElementById('searchMercadorias').value.toLowerCase();
            const filterValue = document.getElementById('filterMercadorias').value;
            
            const filtered = systemData.mercadorias.filter(mercadoria => {
                const empresa = systemData.empresas.find(e => e.id === mercadoria.empresaId);
                const matchesSearch = mercadoria.codigo.includes(searchTerm) || 
                                     mercadoria.descricao.toLowerCase().includes(searchTerm) ||
                                     mercadoria.destinatario.toLowerCase().includes(searchTerm) ||
                                     (empresa && empresa.nome.toLowerCase().includes(searchTerm));
                
                const matchesFilter = filterValue === '' || mercadoria.status === filterValue;
                
                return matchesSearch && matchesFilter;
            });
            
            const tbody = document.querySelector('#mercadoriasTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-box"></i>
                            <p>Nenhuma mercadoria encontrada</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filtered.forEach(mercadoria => {
                const empresa = systemData.empresas.find(e => e.id === mercadoria.empresaId);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${mercadoria.codigo}</td>
                    <td>${mercadoria.descricao}</td>
                    <td>${empresa ? empresa.nome : 'N/A'}</td>
                    <td>${mercadoria.destinatario}</td>
                    <td>${formatDate(mercadoria.dataRecebimento)}</td>
                    <td><span class="status ${mercadoria.status}">${mercadoria.status}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-primary btn-sm" onclick="editMercadoria(${mercadoria.id})">
                            <i class="fas fa-eye"></i> Detalhes
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="updateMercadoriaStatus(${mercadoria.id}, 'entregue')">
                            <i class="fas fa-check"></i> Dar Baixa
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Funções auxiliares
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'N/A';
            const date = new Date(dateTimeString);
            return date.toLocaleString('pt-BR');
        }

        function getStatusText(status) {
            const statusMap = {
                'pendente': 'Pendente',
                'em-andamento': 'Em Andamento',
                'entregue': 'Entregue',
                'cancelado': 'Cancelado',
                'ativo': 'Ativo',
                'inativo': 'Inativo'
            };
            return statusMap[status] || status;
        }

        function addLog(acao, detalhes) {
            const novoLog = {
                id: systemData.logs.length > 0 ? Math.max(...systemData.logs.map(l => l.id)) + 1 : 1,
                data: new Date().toISOString(),
                usuario: 'Administrador',
                acao: acao,
                detalhes: detalhes
            };
            
            systemData.logs.unshift(novoLog);
            saveDataToStorage();
            renderLogs();
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            resetInactivityTimer();
        }

        function openModalEntrega() {
            populateEmpresasSelect('entregaEmpresa');
            populateEntregadoresSelect('entregaEntregador');
            populateMercadoriasSelect('entregaMercadoria');
            openModal('modalEntrega');
        }

        // Sistema de notificações toast
        function showToast(title, message, type) {
            const toastContainer = document.querySelector('.toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="close-toast">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            const autoClose = setTimeout(() => {
                closeToast(toast);
            }, 5000);
            
            toast.querySelector('.close-toast').addEventListener('click', () => {
                clearTimeout(autoClose);
                closeToast(toast);
            });
        }

        function closeToast(toast) {
            toast.classList.remove('show');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }

        // Funções de edição e exclusão
        function editEmpresa(id) {
            const empresa = systemData.empresas.find(e => e.id === id);
            if (empresa) {
                document.getElementById('empresaNome').value = empresa.nome;
                document.getElementById('empresaCnpj').value = empresa.cnpj || '';
                document.getElementById('empresaEmail').value = empresa.email || '';
                document.getElementById('empresaTelefone').value = empresa.telefone;
                document.getElementById('empresaEndereco').value = empresa.endereco || '';
                document.getElementById('empresaPagamento').value = empresa.pagamento || '';
                document.getElementById('empresaValor').value = empresa.valorEntrega || '';
                
                // Alterar o formulário para modo edição
                const form = document.getElementById('formEmpresa');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    updateEmpresa(id);
                };
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Empresa';
                
                openModal('modalEmpresa');
            }
        }

        function updateEmpresa(id) {
            const empresa = systemData.empresas.find(e => e.id === id);
            if (empresa) {
                empresa.nome = document.getElementById('empresaNome').value;
                empresa.cnpj = document.getElementById('empresaCnpj').value || null;
                empresa.email = document.getElementById('empresaEmail').value || null;
                empresa.telefone = document.getElementById('empresaTelefone').value;
                empresa.endereco = document.getElementById('empresaEndereco').value || null;
                empresa.pagamento = document.getElementById('empresaPagamento').value || null;
                empresa.valorEntrega = document.getElementById('empresaValor').value ? parseFloat(document.getElementById('empresaValor').value) : null;
                
                saveDataToStorage();
                renderEmpresas();
                
                // Restaurar formulário para modo criação
                const form = document.getElementById('formEmpresa');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    saveEmpresa();
                };
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Empresa';
                
                document.getElementById('formEmpresa').reset();
                document.getElementById('modalEmpresa').style.display = 'none';
                
                addLog('Empresa Atualizada', `Empresa "${empresa.nome}" atualizada`);
                showToast('Empresa Atualizada', `Empresa "${empresa.nome}" atualizada com sucesso!`, 'success');
            }
        }

        function deleteEmpresa(id) {
            if (confirm('Tem certeza que deseja excluir esta empresa?')) {
                const empresa = systemData.empresas.find(e => e.id === id);
                systemData.empresas = systemData.empresas.filter(e => e.id !== id);
                saveDataToStorage();
                renderEmpresas();
                
                addLog('Empresa Excluída', `Empresa "${empresa.nome}" excluída`);
                showToast('Empresa Excluída', 'Empresa excluída com sucesso!', 'success');
            }
        }

        function editEntregador(id) {
            const entregador = systemData.entregadores.find(e => e.id === id);
            if (entregador) {
                document.getElementById('entregadorNome').value = entregador.nome;
                document.getElementById('entregadorCpf').value = entregador.cpf || '';
                document.getElementById('entregadorTelefone').value = entregador.telefone;
                document.getElementById('entregadorVeiculo').value = entregador.veiculo || '';
                document.getElementById('entregadorComissao').value = entregador.comissao || '';
                document.getElementById('entregadorStatus').value = entregador.status || 'ativo';
                
                // Alterar o formulário para modo edição
                const form = document.getElementById('formEntregador');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    updateEntregador(id);
                };
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Entregador';
                
                openModal('modalEntregador');
            }
        }

        function updateEntregador(id) {
            const entregador = systemData.entregadores.find(e => e.id === id);
            if (entregador) {
                entregador.nome = document.getElementById('entregadorNome').value;
                entregador.cpf = document.getElementById('entregadorCpf').value || null;
                entregador.telefone = document.getElementById('entregadorTelefone').value;
                entregador.veiculo = document.getElementById('entregadorVeiculo').value || null;
                entregador.comissao = document.getElementById('entregadorComissao').value ? parseFloat(document.getElementById('entregadorComissao').value) : null;
                entregador.status = document.getElementById('entregadorStatus').value || 'ativo';
                
                saveDataToStorage();
                renderEntregadores();
                
                // Restaurar formulário para modo criação
                const form = document.getElementById('formEntregador');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    saveEntregador();
                };
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Entregador';
                
                document.getElementById('formEntregador').reset();
                document.getElementById('modalEntregador').style.display = 'none';
                
                addLog('Entregador Atualizado', `Entregador "${entregador.nome}" atualizado`);
                showToast('Entregador Atualizado', `Entregador "${entregador.nome}" atualizado com sucesso!`, 'success');
            }
        }

        function deleteEntregador(id) {
            if (confirm('Tem certeza que deseja excluir este entregador?')) {
                const entregador = systemData.entregadores.find(e => e.id === id);
                systemData.entregadores = systemData.entregadores.filter(e => e.id !== id);
                saveDataToStorage();
                renderEntregadores();
                
                addLog('Entregador Excluído', `Entregador "${entregador.nome}" excluído`);
                showToast('Entregador Excluído', 'Entregador excluído com sucesso!', 'success');
            }
        }

        function editMercadoria(id) {
            const mercadoria = systemData.mercadorias.find(m => m.id === id);
            if (mercadoria) {
                document.getElementById('mercadoriaCodigo').value = mercadoria.codigo;
                document.getElementById('mercadoriaDescricao').value = mercadoria.descricao;
                document.getElementById('mercadoriaDestinatario').value = mercadoria.destinatario;
                document.getElementById('mercadoriaEndereco').value = mercadoria.endereco;
                document.getElementById('mercadoriaValor').value = mercadoria.valor;
                document.getElementById('mercadoriaStatus').value = mercadoria.status;
                
                // Popular select de empresas
                populateEmpresasSelect('mercadoriaEmpresa');
                document.getElementById('mercadoriaEmpresa').value = mercadoria.empresaId;
                
                // Alterar o formulário para modo edição
                const form = document.getElementById('formMercadoria');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    updateMercadoria(id);
                };
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Mercadoria';
                
                openModal('modalMercadoria');
            }
        }

        function updateMercadoria(id) {
            const mercadoria = systemData.mercadorias.find(m => m.id === id);
            if (mercadoria) {
                mercadoria.codigo = document.getElementById('mercadoriaCodigo').value;
                mercadoria.descricao = document.getElementById('mercadoriaDescricao').value;
                mercadoria.empresaId = parseInt(document.getElementById('mercadoriaEmpresa').value);
                mercadoria.destinatario = document.getElementById('mercadoriaDestinatario').value;
                mercadoria.endereco = document.getElementById('mercadoriaEndereco').value;
                mercadoria.valor = parseFloat(document.getElementById('mercadoriaValor').value);
                mercadoria.status = document.getElementById('mercadoriaStatus').value;
                
                saveDataToStorage();
                renderMercadorias();
                
                // Restaurar formulário para modo criação
                const form = document.getElementById('formMercadoria');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    saveMercadoria();
                };
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Mercadoria';
                
                document.getElementById('formMercadoria').reset();
                document.getElementById('modalMercadoria').style.display = 'none';
                
                addLog('Mercadoria Atualizada', `Mercadoria "${mercadoria.descricao}" atualizada`);
                showToast('Mercadoria Atualizada', `Mercadoria "${mercadoria.descricao}" atualizada com sucesso!`, 'success');
            }
        }
    </script>
</body>
</html>
